<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lembar Kerja Refleksi Fungsi - Kelas 12</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .math-input {
            font-family: 'Times New Roman', serif;
            font-size: 18px;
            position: relative;
        }
        .math-preview {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 0.5rem 0.5rem;
            padding: 8px 12px;
            font-size: 16px;
            color: #374151;
            z-index: 10;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            min-height: 40px;
            display: none;
        }
        .math-input:focus + .math-preview,
        .math-preview.show {
            display: block;
        }
        .keyboard-btn {
            transition: all 0.2s;
            position: relative;
            font-family: 'Times New Roman', serif;
        }
        .keyboard-btn:hover {
            transform: scale(1.05);
        }
        .keyboard-btn:active {
            transform: scale(0.95);
        }
        .keyboard-btn .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 1000;
        }
        .keyboard-btn:hover .tooltip {
            opacity: 1;
        }
        .keyboard-group {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 8px;
        }
        .keyboard-group-title {
            font-size: 12px;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 4px;
            text-align: center;
        }
        .section-card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .answer-format {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 8px 12px;
            margin: 4px 0;
            font-family: 'Times New Roman', serif;
            font-size: 16px;
        }
        .answer-format-label {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 2px;
        }
        .input-valid {
            border-color: #10b981 !important;
            background-color: #f0fdf4;
        }
        .input-invalid {
            border-color: #ef4444 !important;
            background-color: #fef2f2;
        }
        .math-preview {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 0.5rem 0.5rem;
            padding: 8px 12px;
            font-size: 16px;
            color: #374151;
            z-index: 10;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            min-height: 40px;
            display: none;
        }
        .math-input:focus + .math-preview,
        .math-preview.show {
            display: block;
        }
        .keyboard-btn {
            transition: all 0.2s;
        }
        .keyboard-btn:hover {
            transform: scale(1.05);
        }
        .keyboard-btn:active {
            transform: scale(0.95);
        }
        .section-card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-indigo-800 mb-2">Lembar Kerja Refleksi Fungsi</h1>
            <p class="text-lg text-gray-600">Kelas 12 - Matematika Wajib</p>
            <p class="text-sm text-gray-500 mt-2">Refleksi terhadap Sumbu X dan Sumbu Y</p>
        </div>

        <!-- Tab Navigation -->
        <div class="flex justify-center mb-8">
            <div class="bg-white rounded-lg p-1 shadow-lg">
                <button onclick="showTab('sumbu-x')" id="tab-x" class="px-6 py-3 rounded-md font-semibold transition-all bg-indigo-600 text-white">
                    Refleksi Sumbu X
                </button>
                <button onclick="showTab('sumbu-y')" id="tab-y" class="px-6 py-3 rounded-md font-semibold transition-all text-indigo-600 hover:bg-indigo-50">
                    Refleksi Sumbu Y
                </button>
            </div>
        </div>

        <!-- Virtual Math Keyboard Template (Hidden by default) -->
        <div id="mathKeyboardTemplate" class="section-card bg-white rounded-xl p-4 mb-4 shadow-lg border-2 border-indigo-200 hidden">
            <div class="flex justify-between items-center mb-3">
                <h4 class="text-lg font-bold text-gray-800">🧮 Keyboard Matematika</h4>
                <button onclick="hideCurrentKeyboard()" class="text-gray-500 hover:text-gray-700 text-xl font-bold">&times;</button>
            </div>
            <div class="mb-3">
                <div class="p-2 bg-gray-50 rounded-lg min-h-[40px] border text-sm">
                    <div id="currentMathPreview">Preview akan muncul di sini...</div>
                </div>
                <div class="text-xs text-gray-500 mt-1">Shortcut: Ctrl+2 (²), Ctrl+3 (³), Ctrl+X (ˣ)</div>
            </div>
            
            <!-- Numbers Group -->
            <div class="keyboard-group">
                <div class="keyboard-group-title">Angka & Operator</div>
                <div class="grid grid-cols-8 gap-1">
                    <button class="keyboard-btn bg-blue-100 hover:bg-blue-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('1')">1<span class="tooltip">Angka 1</span></button>
                    <button class="keyboard-btn bg-blue-100 hover:bg-blue-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('2')">2<span class="tooltip">Angka 2</span></button>
                    <button class="keyboard-btn bg-blue-100 hover:bg-blue-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('3')">3<span class="tooltip">Angka 3</span></button>
                    <button class="keyboard-btn bg-blue-100 hover:bg-blue-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('4')">4<span class="tooltip">Angka 4</span></button>
                    <button class="keyboard-btn bg-blue-100 hover:bg-blue-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('5')">5<span class="tooltip">Angka 5</span></button>
                    <button class="keyboard-btn bg-blue-100 hover:bg-blue-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('6')">6<span class="tooltip">Angka 6</span></button>
                    <button class="keyboard-btn bg-blue-100 hover:bg-blue-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('7')">7<span class="tooltip">Angka 7</span></button>
                    <button class="keyboard-btn bg-blue-100 hover:bg-blue-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('8')">8<span class="tooltip">Angka 8</span></button>
                    
                    <button class="keyboard-btn bg-blue-100 hover:bg-blue-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('9')">9<span class="tooltip">Angka 9</span></button>
                    <button class="keyboard-btn bg-blue-100 hover:bg-blue-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('0')">0<span class="tooltip">Angka 0</span></button>
                    <button class="keyboard-btn bg-green-100 hover:bg-green-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('+')">+<span class="tooltip">Tambah</span></button>
                    <button class="keyboard-btn bg-green-100 hover:bg-green-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('-')">−<span class="tooltip">Kurang</span></button>
                    <button class="keyboard-btn bg-green-100 hover:bg-green-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('·')">·<span class="tooltip">Kali (dot)</span></button>
                    <button class="keyboard-btn bg-green-100 hover:bg-green-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('×')">×<span class="tooltip">Kali (cross)</span></button>
                    <button class="keyboard-btn bg-green-100 hover:bg-green-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('÷')">÷<span class="tooltip">Bagi</span></button>
                    <button class="keyboard-btn bg-red-100 hover:bg-red-200 p-2 rounded text-sm font-semibold" onclick="clearActiveInput()">C<span class="tooltip">Clear</span></button>
                </div>
            </div>
            
            <!-- Functions Group -->
            <div class="keyboard-group">
                <div class="keyboard-group-title">Fungsi & Variabel</div>
                <div class="grid grid-cols-6 gap-1">
                    <button class="keyboard-btn bg-purple-100 hover:bg-purple-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('f(x) = ')">f(x) =<span class="tooltip">Fungsi f</span></button>
                    <button class="keyboard-btn bg-purple-100 hover:bg-purple-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('g(x) = ')">g(x) =<span class="tooltip">Fungsi g</span></button>
                    <button class="keyboard-btn bg-purple-100 hover:bg-purple-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('x')">x<span class="tooltip">Variabel x</span></button>
                    <button class="keyboard-btn bg-purple-100 hover:bg-purple-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('y')">y<span class="tooltip">Variabel y</span></button>
                    <button class="keyboard-btn bg-yellow-100 hover:bg-yellow-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('(')">(<span class="tooltip">Kurung buka</span></button>
                    <button class="keyboard-btn bg-yellow-100 hover:bg-yellow-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive(')')">)<span class="tooltip">Kurung tutup</span></button>
                </div>
            </div>
            
            <!-- Exponents Group -->
            <div class="keyboard-group">
                <div class="keyboard-group-title">Eksponen & Pangkat</div>
                <div class="grid grid-cols-6 gap-1 mb-2">
                    <button class="keyboard-btn bg-orange-100 hover:bg-orange-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('²')">x²<span class="tooltip">Pangkat 2</span></button>
                    <button class="keyboard-btn bg-orange-100 hover:bg-orange-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('³')">x³<span class="tooltip">Pangkat 3</span></button>
                    <button class="keyboard-btn bg-orange-100 hover:bg-orange-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('ˣ')">2ˣ<span class="tooltip">Eksponen x</span></button>
                    <button class="keyboard-btn bg-orange-100 hover:bg-orange-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('ⁿ')">xⁿ<span class="tooltip">Pangkat n</span></button>
                    <button class="keyboard-btn bg-orange-100 hover:bg-orange-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('⁽⁾')">⁽⁾<span class="tooltip">Kurung eksponen</span></button>
                    <button class="keyboard-btn bg-orange-100 hover:bg-orange-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('√')">√<span class="tooltip">Akar kuadrat</span></button>
                </div>
                <div class="grid grid-cols-4 gap-1">
                    <button class="keyboard-btn bg-indigo-100 hover:bg-indigo-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('⁽ˣ⁺²⁾')">⁽ˣ⁺²⁾<span class="tooltip">Eksponen (x+2)</span></button>
                    <button class="keyboard-btn bg-indigo-100 hover:bg-indigo-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('⁽ˣ⁻³⁾')">⁽ˣ⁻³⁾<span class="tooltip">Eksponen (x-3)</span></button>
                    <button class="keyboard-btn bg-indigo-100 hover:bg-indigo-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('9·3ˣ')">9·3ˣ<span class="tooltip">Koefisien eksponen</span></button>
                    <button class="keyboard-btn bg-indigo-100 hover:bg-indigo-200 p-2 rounded text-sm font-semibold" onclick="insertSymbolToActive('4·2ˣ')">4·2ˣ<span class="tooltip">Koefisien eksponen</span></button>
                </div>
            </div>
        </div>

        <!-- Sumbu X Content -->
        <div id="sumbu-x-content" class="tab-content">
            <div class="section-card bg-white rounded-xl p-6 mb-8">
                <h2 class="text-2xl font-bold text-indigo-700 mb-6">📐 Refleksi terhadap Sumbu X</h2>
                
                <!-- Aktivitas 1: Penemuan Rumus -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">🔍 Aktivitas 1: Temukan Rumus Sendiri!</h3>
                    
                    <!-- Langkah 1: Observasi Pola -->
                    <div class="bg-blue-50 p-6 rounded-lg mb-4">
                        <h4 class="text-lg font-semibold text-blue-800 mb-3">📊 Langkah 1: Amati Pola Transformasi</h4>
                        <p class="text-gray-700 mb-4">Mari kita amati apa yang terjadi pada koordinat titik-titik ketika fungsi direfleksikan terhadap sumbu X:</p>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div class="bg-white p-4 rounded-lg border-l-4 border-blue-500">
                                <h5 class="font-semibold mb-2 text-blue-700">Fungsi Asli:</h5>
                                <p>• $f(x) = x$ → titik $(1, 1), (2, 2), (3, 3)$</p>
                                <p>• $f(x) = x^2$ → titik $(1, 1), (2, 4), (3, 9)$</p>
                                <p>• $f(x) = 2^x$ → titik $(1, 2), (2, 4), (3, 8)$</p>
                            </div>
                            <div class="bg-white p-4 rounded-lg border-l-4 border-red-500">
                                <h5 class="font-semibold mb-2 text-red-700">Setelah Refleksi Sumbu X:</h5>
                                <p>• Hasil: titik $(1, -1), (2, -2), (3, -3)$</p>
                                <p>• Hasil: titik $(1, -1), (2, -4), (3, -9)$</p>
                                <p>• Hasil: titik $(1, -2), (2, -4), (3, -8)$</p>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-100 p-4 rounded-lg mb-4">
                            <h5 class="font-semibold mb-2">🤔 Pertanyaan Pemandu:</h5>
                            <div class="space-y-2">
                                <div class="flex items-start gap-2">
                                    <span class="text-yellow-600 font-bold">1.</span>
                                    <span>Apa yang terjadi pada koordinat x dari setiap titik?</span>
                                    <div class="flex items-center gap-1 ml-2 relative">
                                        <input type="text" id="q1-x" class="math-input px-2 py-1 border rounded text-sm" placeholder="Jawab...">
                                        <div id="preview-q1-x" class="math-preview"></div>
                                        <button onclick="showKeyboardFor('q1-x')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600" title="Bantuan Keyboard">🧮</button>
                                    </div>
                                </div>
                                <div id="keyboard-q1-x" class="keyboard-container hidden"></div>
                                <div class="flex items-start gap-2">
                                    <span class="text-yellow-600 font-bold">2.</span>
                                    <span>Apa yang terjadi pada koordinat y dari setiap titik?</span>
                                    <div class="flex items-center gap-1 ml-2 relative">
                                        <input type="text" id="q2-x" class="math-input px-2 py-1 border rounded text-sm" placeholder="Jawab...">
                                        <div id="preview-q2-x" class="math-preview"></div>
                                        <button onclick="showKeyboardFor('q2-x')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600" title="Bantuan Keyboard">🧮</button>
                                    </div>
                                </div>
                                <div id="keyboard-q2-x" class="keyboard-container hidden"></div>
                                <div class="flex items-start gap-2">
                                    <span class="text-yellow-600 font-bold">3.</span>
                                    <span>Jika titik asli adalah $(a, b)$, maka titik hasil refleksi adalah $(?, ?)$</span>
                                    <div class="flex items-center gap-1 ml-2 relative">
                                        <input type="text" id="q3-x" class="math-input px-2 py-1 border rounded text-sm" placeholder="Jawab...">
                                        <div id="preview-q3-x" class="math-preview"></div>
                                        <button onclick="showKeyboardFor('q3-x')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600" title="Bantuan Keyboard">🧮</button>
                                    </div>
                                </div>
                                <div id="keyboard-q3-x" class="keyboard-container hidden"></div>
                            </div>
                            <button onclick="checkObservationX()" class="mt-3 bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors">Periksa Pengamatan</button>
                            <div id="observation-feedback-x" class="mt-2"></div>
                        </div>
                    </div>

                    <!-- Langkah 2: Analisis Fungsi -->
                    <div class="bg-green-50 p-6 rounded-lg mb-4">
                        <h4 class="text-lg font-semibold text-green-800 mb-3">🔬 Langkah 2: Analisis Perubahan Fungsi</h4>
                        <p class="text-gray-700 mb-4">Sekarang mari kita lihat bagaimana perubahan ini mempengaruhi rumus fungsi:</p>
                        
                        <div class="bg-white p-4 rounded-lg mb-4">
                            <h5 class="font-semibold mb-3">Contoh Analisis:</h5>
                            <div class="space-y-3">
                                <div class="border-l-4 border-green-500 pl-4">
                                    <p><strong>Fungsi asli:</strong> $f(x) = 2x + 1$</p>
                                    <p><strong>Untuk x = 1:</strong> $f(1) = 2(1) + 1 = 3$ → titik $(1, 3)$</p>
                                    <p><strong>Setelah refleksi:</strong> titik $(1, -3)$</p>
                                    <p><strong>Nilai fungsi baru:</strong> $g(1) = -3$</p>
                                </div>
                                <div class="border-l-4 border-green-500 pl-4">
                                    <p><strong>Untuk x = 2:</strong> $f(2) = 2(2) + 1 = 5$ → titik $(2, 5)$</p>
                                    <p><strong>Setelah refleksi:</strong> titik $(2, -5)$</p>
                                    <p><strong>Nilai fungsi baru:</strong> $g(2) = -5$</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-blue-100 p-4 rounded-lg">
                            <h5 class="font-semibold mb-2">💡 Pertanyaan Kunci:</h5>
                            <p class="mb-2">Jika $f(x) = 2x + 1$, dan kita tahu bahwa:</p>
                            <p class="mb-2">• $g(1) = -f(1) = -3$</p>
                            <p class="mb-2">• $g(2) = -f(2) = -5$</p>
                            <p class="mb-3">Maka secara umum, $g(x) = ?$</p>
                            <div class="flex items-center gap-2 relative">
                                <input type="text" id="pattern-x" class="math-input flex-1 px-3 py-2 border rounded" placeholder="g(x) = ...">
                                <div id="preview-pattern-x" class="math-preview"></div>
                                <button onclick="showKeyboardFor('pattern-x')" class="bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600" title="Bantuan Keyboard">🧮</button>
                            </div>
                            <div id="keyboard-pattern-x" class="keyboard-container hidden mt-2"></div>
                            <button onclick="checkPatternX()" class="mt-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">Periksa Pola</button>
                            <div id="pattern-feedback-x" class="mt-2"></div>
                        </div>
                    </div>

                    <!-- Langkah 3: Perumusan -->
                    <div class="bg-purple-50 p-6 rounded-lg mb-4">
                        <h4 class="text-lg font-semibold text-purple-800 mb-3">📝 Langkah 3: Rumuskan Kesimpulan</h4>
                        <p class="text-gray-700 mb-4">Berdasarkan pengamatan dan analisis di atas, sekarang rumuskan kesimpulan umum:</p>
                        
                        <div class="bg-white p-4 rounded-lg mb-4">
                            <h5 class="font-semibold mb-2">Kesimpulan Saya:</h5>
                            <p class="mb-2">Jika $f(x)$ adalah fungsi asli, maka hasil refleksi terhadap sumbu X adalah:</p>
                            <div class="flex items-center gap-2 mb-2 relative">
                                <input type="text" id="rumus-x-discovery" class="math-input flex-1 p-3 border-2 border-purple-300 rounded-lg focus:border-purple-500 focus:outline-none" placeholder="g(x) = ...">
                                <div id="preview-rumus-x-discovery" class="math-preview"></div>
                                <button onclick="showKeyboardFor('rumus-x-discovery')" class="bg-blue-500 text-white px-3 py-3 rounded-lg hover:bg-blue-600" title="Bantuan Keyboard">🧮</button>
                            </div>
                            <div id="keyboard-rumus-x-discovery" class="keyboard-container hidden mb-2"></div>
                            
                            <div class="mt-3">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Jelaskan alasan Anda:</label>
                                <textarea id="reasoning-x" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none" rows="3" placeholder="Mengapa rumus tersebut benar? Jelaskan berdasarkan pengamatan Anda..."></textarea>
                            </div>
                            
                            <button onclick="checkRumusX()" class="mt-3 bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors">Periksa Rumus Final</button>
                            <div id="feedback-rumus-x" class="mt-3"></div>
                        </div>
                    </div>
                </div>

                <!-- Aktivitas 2: Contoh Soal -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">📚 Aktivitas 2: Contoh Soal</h3>
                    <div class="space-y-4">
                        <div class="bg-green-50 p-6 rounded-lg">
                            <h4 class="font-semibold text-green-800 mb-3">Contoh 1: Fungsi Linear</h4>
                            <p class="mb-2"><strong>Soal:</strong> Tentukan hasil refleksi $f(x) = 2x + 3$ terhadap sumbu X!</p>
                            <p class="mb-2"><strong>Penyelesaian:</strong></p>
                            <p class="mb-1">Rumus refleksi sumbu X: $g(x) = -f(x)$</p>
                            <p class="mb-1">$g(x) = -(2x + 3) = -2x - 3$</p>
                            <p><strong>Jawaban:</strong> $g(x) = -2x - 3$</p>
                        </div>
                        
                        <div class="bg-green-50 p-6 rounded-lg">
                            <h4 class="font-semibold text-green-800 mb-3">Contoh 2: Fungsi Kuadrat</h4>
                            <p class="mb-2"><strong>Soal:</strong> Tentukan hasil refleksi $f(x) = x^2 - 4x + 1$ terhadap sumbu X!</p>
                            <p class="mb-2"><strong>Penyelesaian:</strong></p>
                            <p class="mb-1">$g(x) = -f(x) = -(x^2 - 4x + 1)$</p>
                            <p class="mb-1">$g(x) = -x^2 + 4x - 1$</p>
                            <p><strong>Jawaban:</strong> $g(x) = -x^2 + 4x - 1$</p>
                        </div>
                        
                        <div class="bg-green-50 p-6 rounded-lg">
                            <h4 class="font-semibold text-green-800 mb-3">Contoh 3: Fungsi Eksponensial</h4>
                            <p class="mb-2"><strong>Soal:</strong> Tentukan hasil refleksi $f(x) = 3^x$ terhadap sumbu X!</p>
                            <p class="mb-2"><strong>Penyelesaian:</strong></p>
                            <p class="mb-1">$g(x) = -f(x) = -3^x$</p>
                            <p><strong>Jawaban:</strong> $g(x) = -3^x$</p>
                        </div>
                    </div>
                </div>

                <!-- Aktivitas 3: Latihan Soal -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">✏️ Aktivitas 3: Latihan Soal (10 Soal)</h3>
                    <div class="bg-yellow-50 p-6 rounded-lg">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-lg font-semibold">Soal <span id="current-question-x">1</span> dari 10</span>
                            <button onclick="generateNewQuestionX()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">Soal Baru</button>
                        </div>
                        <div id="question-x" class="mb-4 text-lg"></div>
                        <div class="flex items-center gap-2 mb-4 relative">
                            <input type="text" id="answer-x" class="math-input flex-1 p-3 border-2 border-yellow-300 rounded-lg focus:border-yellow-500 focus:outline-none" placeholder="Masukkan jawaban Anda...">
                            <div id="preview-answer-x" class="math-preview"></div>
                            <button onclick="showKeyboardFor('answer-x')" class="bg-blue-500 text-white px-3 py-3 rounded-lg hover:bg-blue-600" title="Bantuan Keyboard">🧮</button>
                        </div>
                        <div id="keyboard-answer-x" class="keyboard-container hidden mb-4"></div>
                        <div class="flex gap-2">
                            <button onclick="checkAnswerX()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">Periksa</button>
                            <button onclick="nextQuestionX()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">Soal Berikutnya</button>
                        </div>
                        <div id="feedback-x" class="mt-4"></div>
                        <div class="mt-4">
                            <div class="bg-white p-3 rounded-lg">
                                <span class="font-semibold">Skor: </span>
                                <span id="score-x" class="text-green-600 font-bold">0</span>/10
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sumbu Y Content -->
        <div id="sumbu-y-content" class="tab-content hidden">
            <div class="section-card bg-white rounded-xl p-6 mb-8">
                <h2 class="text-2xl font-bold text-purple-700 mb-6">📐 Refleksi terhadap Sumbu Y</h2>
                
                <!-- Aktivitas 1: Penemuan Rumus -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">🔍 Aktivitas 1: Temukan Rumus Sendiri!</h3>
                    
                    <!-- Langkah 1: Observasi Pola -->
                    <div class="bg-purple-50 p-6 rounded-lg mb-4">
                        <h4 class="text-lg font-semibold text-purple-800 mb-3">📊 Langkah 1: Amati Pola Transformasi</h4>
                        <p class="text-gray-700 mb-4">Mari kita amati apa yang terjadi pada koordinat titik-titik ketika fungsi direfleksikan terhadap sumbu Y:</p>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-4">
                            <div class="bg-white p-4 rounded-lg border-l-4 border-purple-500">
                                <h5 class="font-semibold mb-2 text-purple-700">Fungsi Asli:</h5>
                                <p>• $f(x) = x$ → titik $(1, 1), (2, 2), (3, 3)$</p>
                                <p>• $f(x) = x^2$ → titik $(1, 1), (2, 4), (3, 9)$</p>
                                <p>• $f(x) = 2^x$ → titik $(1, 2), (2, 4), (3, 8)$</p>
                            </div>
                            <div class="bg-white p-4 rounded-lg border-l-4 border-red-500">
                                <h5 class="font-semibold mb-2 text-red-700">Setelah Refleksi Sumbu Y:</h5>
                                <p>• Hasil: titik $(-1, 1), (-2, 2), (-3, 3)$</p>
                                <p>• Hasil: titik $(-1, 1), (-2, 4), (-3, 9)$</p>
                                <p>• Hasil: titik $(-1, 2), (-2, 4), (-3, 8)$</p>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-100 p-4 rounded-lg mb-4">
                            <h5 class="font-semibold mb-2">🤔 Pertanyaan Pemandu:</h5>
                            <div class="space-y-2">
                                <div class="flex items-start gap-2">
                                    <span class="text-yellow-600 font-bold">1.</span>
                                    <span>Apa yang terjadi pada koordinat x dari setiap titik?</span>
                                    <div class="flex items-center gap-1 ml-2 relative">
                                        <input type="text" id="q1-y" class="math-input px-2 py-1 border rounded text-sm" placeholder="Jawab...">
                                        <div id="preview-q1-y" class="math-preview"></div>
                                        <button onclick="showKeyboardFor('q1-y')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600" title="Bantuan Keyboard">🧮</button>
                                    </div>
                                </div>
                                <div id="keyboard-q1-y" class="keyboard-container hidden"></div>
                                <div class="flex items-start gap-2">
                                    <span class="text-yellow-600 font-bold">2.</span>
                                    <span>Apa yang terjadi pada koordinat y dari setiap titik?</span>
                                    <div class="flex items-center gap-1 ml-2 relative">
                                        <input type="text" id="q2-y" class="math-input px-2 py-1 border rounded text-sm" placeholder="Jawab...">
                                        <div id="preview-q2-y" class="math-preview"></div>
                                        <button onclick="showKeyboardFor('q2-y')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600" title="Bantuan Keyboard">🧮</button>
                                    </div>
                                </div>
                                <div id="keyboard-q2-y" class="keyboard-container hidden"></div>
                                <div class="flex items-start gap-2">
                                    <span class="text-yellow-600 font-bold">3.</span>
                                    <span>Jika titik asli adalah $(a, b)$, maka titik hasil refleksi adalah $(?, ?)$</span>
                                    <div class="flex items-center gap-1 ml-2 relative">
                                        <input type="text" id="q3-y" class="math-input px-2 py-1 border rounded text-sm" placeholder="Jawab...">
                                        <div id="preview-q3-y" class="math-preview"></div>
                                        <button onclick="showKeyboardFor('q3-y')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600" title="Bantuan Keyboard">🧮</button>
                                    </div>
                                </div>
                                <div id="keyboard-q3-y" class="keyboard-container hidden"></div>
                            </div>
                            <button onclick="checkObservationY()" class="mt-3 bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors">Periksa Pengamatan</button>
                            <div id="observation-feedback-y" class="mt-2"></div>
                        </div>
                    </div>

                    <!-- Langkah 2: Analisis Fungsi -->
                    <div class="bg-green-50 p-6 rounded-lg mb-4">
                        <h4 class="text-lg font-semibold text-green-800 mb-3">🔬 Langkah 2: Analisis Perubahan Fungsi</h4>
                        <p class="text-gray-700 mb-4">Sekarang mari kita lihat bagaimana perubahan ini mempengaruhi rumus fungsi:</p>
                        
                        <div class="bg-white p-4 rounded-lg mb-4">
                            <h5 class="font-semibold mb-3">Contoh Analisis:</h5>
                            <div class="space-y-3">
                                <div class="border-l-4 border-green-500 pl-4">
                                    <p><strong>Fungsi asli:</strong> $f(x) = 2x + 1$</p>
                                    <p><strong>Untuk x = 1:</strong> $f(1) = 2(1) + 1 = 3$ → titik $(1, 3)$</p>
                                    <p><strong>Setelah refleksi:</strong> titik $(-1, 3)$</p>
                                    <p><strong>Nilai fungsi baru untuk x = -1:</strong> $g(-1) = 3$</p>
                                </div>
                                <div class="border-l-4 border-green-500 pl-4">
                                    <p><strong>Untuk x = 2:</strong> $f(2) = 2(2) + 1 = 5$ → titik $(2, 5)$</p>
                                    <p><strong>Setelah refleksi:</strong> titik $(-2, 5)$</p>
                                    <p><strong>Nilai fungsi baru untuk x = -2:</strong> $g(-2) = 5$</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-blue-100 p-4 rounded-lg">
                            <h5 class="font-semibold mb-2">💡 Pertanyaan Kunci:</h5>
                            <p class="mb-2">Jika $f(x) = 2x + 1$, dan kita tahu bahwa:</p>
                            <p class="mb-2">• $g(-1) = f(1) = 3$</p>
                            <p class="mb-2">• $g(-2) = f(2) = 5$</p>
                            <p class="mb-3">Maka secara umum, $g(x) = f(?)$ atau $g(x) = ?$</p>
                            <div class="flex items-center gap-2 relative">
                                <input type="text" id="pattern-y" class="math-input flex-1 px-3 py-2 border rounded" placeholder="g(x) = ...">
                                <div id="preview-pattern-y" class="math-preview"></div>
                                <button onclick="showKeyboardFor('pattern-y')" class="bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600" title="Bantuan Keyboard">🧮</button>
                            </div>
                            <div id="keyboard-pattern-y" class="keyboard-container hidden mt-2"></div>
                            <button onclick="checkPatternY()" class="mt-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">Periksa Pola</button>
                            <div id="pattern-feedback-y" class="mt-2"></div>
                        </div>
                    </div>

                    <!-- Langkah 3: Perumusan -->
                    <div class="bg-indigo-50 p-6 rounded-lg mb-4">
                        <h4 class="text-lg font-semibold text-indigo-800 mb-3">📝 Langkah 3: Rumuskan Kesimpulan</h4>
                        <p class="text-gray-700 mb-4">Berdasarkan pengamatan dan analisis di atas, sekarang rumuskan kesimpulan umum:</p>
                        
                        <div class="bg-white p-4 rounded-lg mb-4">
                            <h5 class="font-semibold mb-2">Kesimpulan Saya:</h5>
                            <p class="mb-2">Jika $f(x)$ adalah fungsi asli, maka hasil refleksi terhadap sumbu Y adalah:</p>
                            <div class="flex items-center gap-2 mb-2 relative">
                                <input type="text" id="rumus-y-discovery" class="math-input flex-1 p-3 border-2 border-indigo-300 rounded-lg focus:border-indigo-500 focus:outline-none" placeholder="g(x) = ...">
                                <div id="preview-rumus-y-discovery" class="math-preview"></div>
                                <button onclick="showKeyboardFor('rumus-y-discovery')" class="bg-blue-500 text-white px-3 py-3 rounded-lg hover:bg-blue-600" title="Bantuan Keyboard">🧮</button>
                            </div>
                            <div id="keyboard-rumus-y-discovery" class="keyboard-container hidden mb-2"></div>
                            
                            <div class="mt-3">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Jelaskan alasan Anda:</label>
                                <textarea id="reasoning-y" class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none" rows="3" placeholder="Mengapa rumus tersebut benar? Jelaskan berdasarkan pengamatan Anda..."></textarea>
                            </div>
                            
                            <button onclick="checkRumusY()" class="mt-3 bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition-colors">Periksa Rumus Final</button>
                            <div id="feedback-rumus-y" class="mt-3"></div>
                        </div>
                    </div>
                </div>

                <!-- Aktivitas 2: Contoh Soal -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">📚 Aktivitas 2: Contoh Soal</h3>
                    <div class="space-y-4">
                        <div class="bg-green-50 p-6 rounded-lg">
                            <h4 class="font-semibold text-green-800 mb-3">Contoh 1: Fungsi Linear</h4>
                            <p class="mb-2"><strong>Soal:</strong> Tentukan hasil refleksi $f(x) = 2x + 3$ terhadap sumbu Y!</p>
                            <p class="mb-2"><strong>Penyelesaian:</strong></p>
                            <p class="mb-1">Rumus refleksi sumbu Y: $g(x) = f(-x)$</p>
                            <p class="mb-1">$g(x) = f(-x) = 2(-x) + 3 = -2x + 3$</p>
                            <p><strong>Jawaban:</strong> $g(x) = -2x + 3$</p>
                        </div>
                        
                        <div class="bg-green-50 p-6 rounded-lg">
                            <h4 class="font-semibold text-green-800 mb-3">Contoh 2: Fungsi Kuadrat</h4>
                            <p class="mb-2"><strong>Soal:</strong> Tentukan hasil refleksi $f(x) = x^2 - 4x + 1$ terhadap sumbu Y!</p>
                            <p class="mb-2"><strong>Penyelesaian:</strong></p>
                            <p class="mb-1">$g(x) = f(-x) = (-x)^2 - 4(-x) + 1$</p>
                            <p class="mb-1">$g(x) = x^2 + 4x + 1$</p>
                            <p><strong>Jawaban:</strong> $g(x) = x^2 + 4x + 1$</p>
                        </div>
                        
                        <div class="bg-green-50 p-6 rounded-lg">
                            <h4 class="font-semibold text-green-800 mb-3">Contoh 3: Fungsi Eksponensial</h4>
                            <p class="mb-2"><strong>Soal:</strong> Tentukan hasil refleksi $f(x) = 3^x$ terhadap sumbu Y!</p>
                            <p class="mb-2"><strong>Penyelesaian:</strong></p>
                            <p class="mb-1">$g(x) = f(-x) = 3^{-x} = \frac{1}{3^x}$</p>
                            <p><strong>Jawaban:</strong> $g(x) = 3^{-x}$ atau $g(x) = \frac{1}{3^x}$</p>
                        </div>
                    </div>
                </div>

                <!-- Aktivitas 3: Latihan Soal -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">✏️ Aktivitas 3: Latihan Soal (10 Soal)</h3>
                    <div class="bg-yellow-50 p-6 rounded-lg">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-lg font-semibold">Soal <span id="current-question-y">1</span> dari 10</span>
                            <button onclick="generateNewQuestionY()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">Soal Baru</button>
                        </div>
                        <div id="question-y" class="mb-4 text-lg"></div>
                        <div class="flex items-center gap-2 mb-4 relative">
                            <input type="text" id="answer-y" class="math-input flex-1 p-3 border-2 border-yellow-300 rounded-lg focus:border-yellow-500 focus:outline-none" placeholder="Masukkan jawaban Anda...">
                            <div id="preview-answer-y" class="math-preview"></div>
                            <button onclick="showKeyboardFor('answer-y')" class="bg-blue-500 text-white px-3 py-3 rounded-lg hover:bg-blue-600" title="Bantuan Keyboard">🧮</button>
                        </div>
                        <div id="keyboard-answer-y" class="keyboard-container hidden mb-4"></div>
                        <div class="flex gap-2">
                            <button onclick="checkAnswerY()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">Periksa</button>
                            <button onclick="nextQuestionY()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors">Soal Berikutnya</button>
                        </div>
                        <div id="feedback-y" class="mt-4"></div>
                        <div class="mt-4">
                            <div class="bg-white p-3 rounded-lg">
                                <span class="font-semibold">Skor: </span>
                                <span id="score-y" class="text-green-600 font-bold">0</span>/10
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentQuestionX = 1;
        let currentQuestionY = 1;
        let scoreX = 0;
        let scoreY = 0;
        let questionsX = [];
        let questionsY = [];
        let currentAnswerX = '';
        let currentAnswerY = '';
        let activeInput = null;

        // Math rendering functions
        function convertToMathDisplay(text) {
            if (!text) return '';
            
            return text
                // Handle Unicode superscripts first
                .replace(/([0-9a-zA-Z])²/g, '$1^{2}')
                .replace(/([0-9a-zA-Z])³/g, '$1^{3}')
                .replace(/([0-9a-zA-Z])ˣ/g, '$1^{x}')
                .replace(/([0-9a-zA-Z])ⁿ/g, '$1^{n}')
                .replace(/⁽([^⁾]+)⁾/g, '^{$1}')
                // Handle powers with parentheses: x^(2+3) -> x^{2+3}
                .replace(/\^(\([^)]+\))/g, '^{$1}')
                // Handle powers with single characters: x^2 -> x^{2}
                .replace(/\^([a-zA-Z0-9])/g, '^{$1}')
                // Handle powers with multiple characters: x^2n -> x^{2n}
                .replace(/\^([a-zA-Z0-9]+)/g, '^{$1}')
                // Handle multiplication symbols
                .replace(/·/g, '\\cdot ')
                .replace(/×/g, '\\times ')
                .replace(/\*/g, '\\cdot ')
                // Handle division
                .replace(/÷/g, '\\div ')
                .replace(/\//g, '\\div ')
                // Handle square root
                .replace(/√\(([^)]+)\)/g, '\\sqrt{$1}')
                .replace(/√/g, '\\sqrt{}')
                // Handle fractions: frac(a,b) -> \frac{a}{b}
                .replace(/frac\(([^,]+),([^)]+)\)/g, '\\frac{$1}{$2}')
                // Handle common functions
                .replace(/sin/g, '\\sin')
                .replace(/cos/g, '\\cos')
                .replace(/tan/g, '\\tan')
                .replace(/log/g, '\\log')
                .replace(/ln/g, '\\ln')
                // Handle infinity
                .replace(/infinity/g, '\\infty')
                // Handle Greek letters
                .replace(/alpha/g, '\\alpha')
                .replace(/beta/g, '\\beta')
                .replace(/gamma/g, '\\gamma')
                .replace(/delta/g, '\\delta')
                .replace(/pi/g, '\\pi')
                .replace(/theta/g, '\\theta');
        }

        function convertToSuperscript(text) {
            if (!text) return '';
            
            return text
                .replace(/\^2/g, '²')
                .replace(/\^3/g, '³')
                .replace(/\^x/g, 'ˣ')
                .replace(/\^n/g, 'ⁿ')
                .replace(/\^\(([^)]+)\)/g, '⁽$1⁾')
                .replace(/\^([0-9])/g, (match, digit) => {
                    const superscripts = {'0':'⁰','1':'¹','2':'²','3':'³','4':'⁴','5':'⁵','6':'⁶','7':'⁷','8':'⁸','9':'⁹'};
                    return superscripts[digit] || match;
                })
                .replace(/\*/g, '·')
                .replace(/\//g, '÷');
        }

        function validateMathInput(text) {
            // Basic validation for common math expressions
            const hasMatchingParens = (text.match(/\(/g) || []).length === (text.match(/\)/g) || []).length;
            const hasValidChars = /^[a-zA-Z0-9+\-*/()=.,\s²³ˣⁿ⁽⁾·×÷√^{}\\]+$/.test(text);
            
            return hasMatchingParens && hasValidChars;
        }

        function setupMathInput(inputElement) {
            const previewId = 'preview-' + inputElement.id;
            const preview = document.getElementById(previewId);
            
            if (!preview) return;
            
            function updatePreview() {
                const text = inputElement.value;
                
                // Validate input
                const isValid = validateMathInput(text);
                inputElement.classList.remove('input-valid', 'input-invalid');
                if (text.trim()) {
                    inputElement.classList.add(isValid ? 'input-valid' : 'input-invalid');
                }
                
                if (!text.trim()) {
                    preview.innerHTML = '';
                    preview.classList.remove('show');
                    return;
                }
                
                const mathText = convertToMathDisplay(text);
                preview.innerHTML = `$${mathText}$`;
                preview.classList.add('show');
                
                if (window.MathJax) {
                    MathJax.typesetPromise([preview]).catch(function (err) {
                        preview.innerHTML = convertToSuperscript(text);
                    });
                }
            }
            
            // Add keyboard shortcuts
            inputElement.addEventListener('keydown', function(e) {
                if (e.ctrlKey) {
                    switch(e.key) {
                        case '2':
                            e.preventDefault();
                            insertAtCursor(inputElement, '²');
                            updatePreview();
                            break;
                        case '3':
                            e.preventDefault();
                            insertAtCursor(inputElement, '³');
                            updatePreview();
                            break;
                        case 'x':
                            e.preventDefault();
                            insertAtCursor(inputElement, 'ˣ');
                            updatePreview();
                            break;
                    }
                }
            });
            
            inputElement.addEventListener('input', updatePreview);
            inputElement.addEventListener('keyup', updatePreview);
            inputElement.addEventListener('paste', () => setTimeout(updatePreview, 10));
            inputElement.addEventListener('focus', updatePreview);
            inputElement.addEventListener('blur', () => {
                setTimeout(() => preview.classList.remove('show'), 200);
            });
        }

        function insertAtCursor(input, text) {
            const cursorPos = input.selectionStart;
            const textBefore = input.value.substring(0, cursorPos);
            const textAfter = input.value.substring(input.selectionEnd);
            
            input.value = textBefore + text + textAfter;
            input.focus();
            input.setSelectionRange(cursorPos + text.length, cursorPos + text.length);
        }

        // Math keyboard functionality
        function showKeyboardFor(inputId) {
            // Hide all other keyboards first
            document.querySelectorAll('.keyboard-container').forEach(container => {
                container.classList.add('hidden');
                container.innerHTML = '';
            });
            
            // Set active input
            activeInput = document.getElementById(inputId);
            
            // Clone keyboard template
            const template = document.getElementById('mathKeyboardTemplate');
            const clone = template.cloneNode(true);
            clone.id = 'keyboard-' + inputId + '-active';
            clone.classList.remove('hidden');
            
            // Show keyboard in the specific container
            const container = document.getElementById('keyboard-' + inputId);
            container.innerHTML = '';
            container.appendChild(clone);
            container.classList.remove('hidden');
            
            updateMathPreview();
        }

        function hideCurrentKeyboard() {
            document.querySelectorAll('.keyboard-container').forEach(container => {
                container.classList.add('hidden');
                container.innerHTML = '';
            });
            activeInput = null;
        }

        function insertSymbolToActive(symbol) {
            if (!activeInput) return;
            
            const cursorPos = activeInput.selectionStart;
            const textBefore = activeInput.value.substring(0, cursorPos);
            const textAfter = activeInput.value.substring(activeInput.selectionEnd);
            
            activeInput.value = textBefore + symbol + textAfter;
            activeInput.focus();
            activeInput.setSelectionRange(cursorPos + symbol.length, cursorPos + symbol.length);
            updateMathPreview();
        }

        function insertExponentToActive() {
            insertSymbolToActive('^2');
        }

        function insertPowerToActive() {
            insertSymbolToActive('^{}');
            if (activeInput) {
                const cursorPos = activeInput.selectionStart;
                activeInput.setSelectionRange(cursorPos - 1, cursorPos - 1);
            }
        }

        function clearActiveInput() {
            if (activeInput) {
                activeInput.value = '';
                updateMathPreview();
            }
        }

        function updateMathPreview() {
            if (!activeInput) return;
            
            const input = activeInput.value;
            const preview = document.getElementById('currentMathPreview');
            
            if (!preview) return;
            
            if (input.trim() === '') {
                preview.innerHTML = 'Preview akan muncul di sini...';
                return;
            }
            
            // Use the same conversion function
            const mathText = convertToMathDisplay(input);
            
            preview.innerHTML = `$$${mathText}$$`;
            
            if (window.MathJax) {
                MathJax.typesetPromise([preview]).catch(function (err) {
                    preview.innerHTML = input;
                });
            }
            
            // Also update the input's preview if it exists
            const inputPreview = document.getElementById('preview-' + activeInput.id);
            if (inputPreview) {
                inputPreview.innerHTML = `$${mathText}$`;
                inputPreview.classList.add('show');
                if (window.MathJax) {
                    MathJax.typesetPromise([inputPreview]).catch(function (err) {
                        inputPreview.innerHTML = input;
                    });
                }
            }
        }

        // New functions for guided discovery
        function checkObservationX() {
            const q1 = document.getElementById('q1-x').value.toLowerCase();
            const q2 = document.getElementById('q2-x').value.toLowerCase();
            const q3 = document.getElementById('q3-x').value.toLowerCase();
            const feedback = document.getElementById('observation-feedback-x');
            
            let correct = 0;
            let message = '<div class="space-y-2">';
            
            if (q1.includes('tetap') || q1.includes('sama') || q1.includes('tidak berubah')) {
                message += '<p class="text-green-600">✅ Benar! Koordinat x tetap sama.</p>';
                correct++;
            } else {
                message += '<p class="text-red-600">❌ Koordinat x seharusnya tetap sama.</p>';
            }
            
            if (q2.includes('negatif') || q2.includes('berlawanan') || q2.includes('tanda')) {
                message += '<p class="text-green-600">✅ Benar! Koordinat y menjadi negatif (berlawanan tanda).</p>';
                correct++;
            } else {
                message += '<p class="text-red-600">❌ Koordinat y berubah menjadi negatif (berlawanan tanda).</p>';
            }
            
            if (q3.includes('a') && q3.includes('-b')) {
                message += '<p class="text-green-600">✅ Benar! Titik (a, b) menjadi (a, -b).</p>';
                correct++;
            } else {
                message += '<p class="text-red-600">❌ Titik (a, b) seharusnya menjadi (a, -b).</p>';
            }
            
            message += '</div>';
            
            if (correct === 3) {
                message += '<div class="mt-3 p-3 bg-green-100 text-green-800 rounded-lg">🎉 Excellent! Anda sudah memahami pola refleksi sumbu X dengan baik!</div>';
            }
            
            feedback.innerHTML = message;
        }

        function checkPatternX() {
            const answer = document.getElementById('pattern-x').value.toLowerCase();
            const feedback = document.getElementById('pattern-feedback-x');
            
            if (answer.includes('-f(x)') || answer.includes('-(2x+1)') || answer.includes('-2x-1')) {
                feedback.innerHTML = '<div class="bg-green-100 text-green-800 p-3 rounded-lg">✅ Benar! g(x) = -f(x) = -(2x + 1) = -2x - 1</div>';
            } else {
                feedback.innerHTML = '<div class="bg-red-100 text-red-800 p-3 rounded-lg">❌ Belum tepat. Ingat bahwa g(x) = -f(x). Coba lagi!</div>';
            }
        }

        function checkObservationY() {
            const q1 = document.getElementById('q1-y').value.toLowerCase();
            const q2 = document.getElementById('q2-y').value.toLowerCase();
            const q3 = document.getElementById('q3-y').value.toLowerCase();
            const feedback = document.getElementById('observation-feedback-y');
            
            let correct = 0;
            let message = '<div class="space-y-2">';
            
            if (q1.includes('negatif') || q1.includes('berlawanan') || q1.includes('tanda')) {
                message += '<p class="text-green-600">✅ Benar! Koordinat x menjadi negatif (berlawanan tanda).</p>';
                correct++;
            } else {
                message += '<p class="text-red-600">❌ Koordinat x berubah menjadi negatif (berlawanan tanda).</p>';
            }
            
            if (q2.includes('tetap') || q2.includes('sama') || q2.includes('tidak berubah')) {
                message += '<p class="text-green-600">✅ Benar! Koordinat y tetap sama.</p>';
                correct++;
            } else {
                message += '<p class="text-red-600">❌ Koordinat y seharusnya tetap sama.</p>';
            }
            
            if (q3.includes('-a') && q3.includes('b')) {
                message += '<p class="text-green-600">✅ Benar! Titik (a, b) menjadi (-a, b).</p>';
                correct++;
            } else {
                message += '<p class="text-red-600">❌ Titik (a, b) seharusnya menjadi (-a, b).</p>';
            }
            
            message += '</div>';
            
            if (correct === 3) {
                message += '<div class="mt-3 p-3 bg-green-100 text-green-800 rounded-lg">🎉 Excellent! Anda sudah memahami pola refleksi sumbu Y dengan baik!</div>';
            }
            
            feedback.innerHTML = message;
        }

        function checkPatternY() {
            const answer = document.getElementById('pattern-y').value.toLowerCase();
            const feedback = document.getElementById('pattern-feedback-y');
            
            if (answer.includes('f(-x)') || answer.includes('2(-x)+1') || answer.includes('-2x+1')) {
                feedback.innerHTML = '<div class="bg-green-100 text-green-800 p-3 rounded-lg">✅ Benar! g(x) = f(-x) = 2(-x) + 1 = -2x + 1</div>';
            } else {
                feedback.innerHTML = '<div class="bg-red-100 text-red-800 p-3 rounded-lg">❌ Belum tepat. Ingat bahwa g(x) = f(-x). Coba lagi!</div>';
            }
        }

        // Tab functionality
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-content').classList.remove('hidden');
            
            // Update tab buttons
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.classList.remove('bg-indigo-600', 'text-white');
                btn.classList.add('text-indigo-600', 'hover:bg-indigo-50');
            });
            
            const activeTab = tabName === 'sumbu-x' ? 'tab-x' : 'tab-y';
            document.getElementById(activeTab).classList.add('bg-indigo-600', 'text-white');
            document.getElementById(activeTab).classList.remove('text-indigo-600', 'hover:bg-indigo-50');
        }

        // Formula checking functions
        function checkRumusX() {
            const answer = document.getElementById('rumus-x-discovery').value.toLowerCase();
            const reasoning = document.getElementById('reasoning-x').value;
            const feedback = document.getElementById('feedback-rumus-x');
            
            if (answer.includes('-f(x)') || answer.includes('g(x) = -f(x)') || answer.includes('negatif')) {
                let message = '<div class="bg-green-100 text-green-800 p-3 rounded-lg">';
                message += '<h6 class="font-semibold mb-2">✅ Rumus Benar!</h6>';
                message += '<p class="mb-2">Refleksi terhadap sumbu X: <strong>g(x) = -f(x)</strong></p>';
                message += '<p class="text-sm">Semua nilai y menjadi negatif, sedangkan nilai x tetap sama.</p>';
                
                if (reasoning.trim() !== '') {
                    message += '<div class="mt-3 p-2 bg-white rounded border-l-4 border-green-500">';
                    message += '<p class="text-sm"><strong>Penjelasan Anda:</strong> ' + reasoning + '</p>';
                    message += '</div>';
                }
                
                message += '</div>';
                feedback.innerHTML = message;
            } else {
                feedback.innerHTML = '<div class="bg-red-100 text-red-800 p-3 rounded-lg">❌ Belum tepat. Perhatikan bahwa koordinat x tetap sama, tapi koordinat y berubah tanda. Rumus yang benar adalah g(x) = -f(x). Coba lagi!</div>';
            }
        }

        function checkRumusY() {
            const answer = document.getElementById('rumus-y-discovery').value.toLowerCase();
            const reasoning = document.getElementById('reasoning-y').value;
            const feedback = document.getElementById('feedback-rumus-y');
            
            if (answer.includes('f(-x)') || answer.includes('g(x) = f(-x)') || (answer.includes('-x') && !answer.includes('-f'))) {
                let message = '<div class="bg-green-100 text-green-800 p-3 rounded-lg">';
                message += '<h6 class="font-semibold mb-2">✅ Rumus Benar!</h6>';
                message += '<p class="mb-2">Refleksi terhadap sumbu Y: <strong>g(x) = f(-x)</strong></p>';
                message += '<p class="text-sm">Semua nilai x menjadi negatif, sedangkan nilai y tetap sama.</p>';
                
                if (reasoning.trim() !== '') {
                    message += '<div class="mt-3 p-2 bg-white rounded border-l-4 border-green-500">';
                    message += '<p class="text-sm"><strong>Penjelasan Anda:</strong> ' + reasoning + '</p>';
                    message += '</div>';
                }
                
                message += '</div>';
                feedback.innerHTML = message;
            } else {
                feedback.innerHTML = '<div class="bg-red-100 text-red-800 p-3 rounded-lg">❌ Belum tepat. Perhatikan bahwa koordinat y tetap sama, tapi koordinat x berubah tanda. Rumus yang benar adalah g(x) = f(-x). Coba lagi!</div>';
            }
        }

        // Question generation for Sumbu X
        function generateQuestionsX() {
            const functions = [
                {q: "f(x) = 3x + 2", a: "g(x) = -3x - 2", type: "linear"},
                {q: "f(x) = -2x + 5", a: "g(x) = 2x - 5", type: "linear"},
                {q: "f(x) = x + 7", a: "g(x) = -x - 7", type: "linear"},
                {q: "f(x) = x^2 + 3", a: "g(x) = -x^2 - 3", type: "kuadrat"},
                {q: "f(x) = 2x^2 - 1", a: "g(x) = -2x^2 + 1", type: "kuadrat"},
                {q: "f(x) = -x^2 + 4x", a: "g(x) = x^2 - 4x", type: "kuadrat"},
                {q: "f(x) = x^2 - 2x + 1", a: "g(x) = -x^2 + 2x - 1", type: "kuadrat"},
                {q: "f(x) = 2^x", a: "g(x) = -2^x", type: "eksponensial"},
                {q: "f(x) = 3^x", a: "g(x) = -3^x", type: "eksponensial"},
                {q: "f(x) = 5^x + 1", a: "g(x) = -5^x - 1", type: "eksponensial"}
            ];
            
            // Shuffle and select 10 questions
            questionsX = functions.sort(() => Math.random() - 0.5).slice(0, 10);
        }

        // Question generation for Sumbu Y
        function generateQuestionsY() {
            const functions = [
                {q: "f(x) = 3x + 2", a: "g(x) = -3x + 2", type: "linear"},
                {q: "f(x) = -2x + 5", a: "g(x) = 2x + 5", type: "linear"},
                {q: "f(x) = x + 7", a: "g(x) = -x + 7", type: "linear"},
                {q: "f(x) = x^2 + 3", a: "g(x) = x^2 + 3", type: "kuadrat"},
                {q: "f(x) = 2x^2 - 1", a: "g(x) = 2x^2 - 1", type: "kuadrat"},
                {q: "f(x) = x^2 + 4x", a: "g(x) = x^2 - 4x", type: "kuadrat"},
                {q: "f(x) = x^2 - 2x + 1", a: "g(x) = x^2 + 2x + 1", type: "kuadrat"},
                {q: "f(x) = 2^x", a: "g(x) = 2^{-x}", type: "eksponensial"},
                {q: "f(x) = 3^x", a: "g(x) = 3^{-x}", type: "eksponensial"},
                {q: "f(x) = 5^x + 1", a: "g(x) = 5^{-x} + 1", type: "eksponensial"}
            ];
            
            // Shuffle and select 10 questions
            questionsY = functions.sort(() => Math.random() - 0.5).slice(0, 10);
        }

        function displayQuestionX() {
            if (currentQuestionX <= questionsX.length) {
                const question = questionsX[currentQuestionX - 1];
                document.getElementById('question-x').innerHTML = `
                    <strong>Soal ${currentQuestionX}:</strong> Tentukan hasil refleksi $${question.q}$ terhadap sumbu X!
                `;
                currentAnswerX = question.a;
                
                // Re-render MathJax
                if (window.MathJax) {
                    MathJax.typesetPromise([document.getElementById('question-x')]);
                }
            }
        }

        function displayQuestionY() {
            if (currentQuestionY <= questionsY.length) {
                const question = questionsY[currentQuestionY - 1];
                document.getElementById('question-y').innerHTML = `
                    <strong>Soal ${currentQuestionY}:</strong> Tentukan hasil refleksi $${question.q}$ terhadap sumbu Y!
                `;
                currentAnswerY = question.a;
                
                // Re-render MathJax
                if (window.MathJax) {
                    MathJax.typesetPromise([document.getElementById('question-y')]);
                }
            }
        }

        function checkAnswerX() {
            const userAnswer = document.getElementById('answer-x').value.trim();
            const feedback = document.getElementById('feedback-x');
            
            if (userAnswer === '') {
                feedback.innerHTML = '<div class="bg-yellow-100 text-yellow-800 p-3 rounded-lg">⚠️ Silakan masukkan jawaban terlebih dahulu!</div>';
                return;
            }
            
            // Generate multiple acceptable formats
            const correctAnswers = generateAnswerFormatsX(currentAnswerX);
            const normalizedUser = normalizeAnswer(userAnswer);
            
            let isCorrect = false;
            for (let answer of correctAnswers) {
                if (normalizedUser === normalizeAnswer(answer)) {
                    isCorrect = true;
                    break;
                }
            }
            
            if (isCorrect) {
                scoreX++;
                document.getElementById('score-x').textContent = scoreX;
                feedback.innerHTML = generateCorrectFeedbackX(correctAnswers);
            } else {
                feedback.innerHTML = generateIncorrectFeedbackX(correctAnswers);
            }
            
            // Re-render MathJax
            if (window.MathJax) {
                MathJax.typesetPromise([feedback]);
            }
        }

        function generateAnswerFormatsX(baseAnswer) {
            // Convert base answer to different formats
            const formats = [];
            
            // Format 1: Standard with g(x) = 
            formats.push(baseAnswer);
            
            // Format 2: Without g(x) = 
            const withoutGx = baseAnswer.replace('g(x) = ', '');
            formats.push(withoutGx);
            
            // Format 3: With superscript notation
            const superscriptFormat = convertToSuperscript(withoutGx);
            formats.push('g(x) = ' + superscriptFormat);
            formats.push(superscriptFormat);
            
            return [...new Set(formats)]; // Remove duplicates
        }

        function generateCorrectFeedbackX(formats) {
            let html = '<div class="bg-green-100 text-green-800 p-4 rounded-lg">';
            html += '<h6 class="font-semibold mb-2">✅ Benar!</h6>';
            html += '<div class="space-y-2">';
            
            formats.slice(0, 4).forEach((format, index) => {
                const labels = ['Format Standar:', 'Format Sederhana:', 'Format Superscript:', 'Format Alternatif:'];
                html += `<div class="answer-format">`;
                html += `<div class="answer-format-label">${labels[index] || 'Format Lain:'}</div>`;
                html += `<div>$${format}$</div>`;
                html += `</div>`;
            });
            
            html += '</div></div>';
            return html;
        }

        function generateIncorrectFeedbackX(formats) {
            let html = '<div class="bg-red-100 text-red-800 p-4 rounded-lg">';
            html += '<h6 class="font-semibold mb-2">❌ Belum tepat</h6>';
            html += '<p class="mb-3">Jawaban yang benar adalah:</p>';
            html += '<div class="space-y-2">';
            
            formats.slice(0, 3).forEach((format, index) => {
                const labels = ['Format Standar:', 'Format Sederhana:', 'Format Superscript:'];
                html += `<div class="answer-format">`;
                html += `<div class="answer-format-label">${labels[index]}</div>`;
                html += `<div>$${format}$</div>`;
                html += `</div>`;
            });
            
            html += '</div></div>';
            return html;
        }

        function normalizeAnswer(answer) {
            return answer
                .replace(/\s/g, '')
                .toLowerCase()
                .replace(/g\(x\)=/g, '')
                .replace(/²/g, '^2')
                .replace(/³/g, '^3')
                .replace(/ˣ/g, '^x')
                .replace(/ⁿ/g, '^n')
                .replace(/⁽([^⁾]+)⁾/g, '^($1)')
                .replace(/·/g, '*')
                .replace(/×/g, '*')
                .replace(/÷/g, '/')
                .replace(/−/g, '-');
        }

        function checkAnswerY() {
            const userAnswer = document.getElementById('answer-y').value.trim();
            const feedback = document.getElementById('feedback-y');
            
            if (userAnswer === '') {
                feedback.innerHTML = '<div class="bg-yellow-100 text-yellow-800 p-3 rounded-lg">⚠️ Silakan masukkan jawaban terlebih dahulu!</div>';
                return;
            }
            
            // Generate multiple acceptable formats
            const correctAnswers = generateAnswerFormatsY(currentAnswerY);
            const normalizedUser = normalizeAnswer(userAnswer);
            
            let isCorrect = false;
            for (let answer of correctAnswers) {
                if (normalizedUser === normalizeAnswer(answer)) {
                    isCorrect = true;
                    break;
                }
            }
            
            if (isCorrect) {
                scoreY++;
                document.getElementById('score-y').textContent = scoreY;
                feedback.innerHTML = generateCorrectFeedbackY(correctAnswers);
            } else {
                feedback.innerHTML = generateIncorrectFeedbackY(correctAnswers);
            }
            
            // Re-render MathJax
            if (window.MathJax) {
                MathJax.typesetPromise([feedback]);
            }
        }

        function generateAnswerFormatsY(baseAnswer) {
            // Convert base answer to different formats
            const formats = [];
            
            // Format 1: Standard with g(x) = 
            formats.push(baseAnswer);
            
            // Format 2: Without g(x) = 
            const withoutGx = baseAnswer.replace('g(x) = ', '');
            formats.push(withoutGx);
            
            // Format 3: With superscript notation
            const superscriptFormat = convertToSuperscript(withoutGx);
            formats.push('g(x) = ' + superscriptFormat);
            formats.push(superscriptFormat);
            
            // Format 4: Alternative exponential notation for Y-axis
            if (withoutGx.includes('^{-x}')) {
                const fractionFormat = withoutGx.replace(/(\d+)\^{-x}/g, '\\frac{1}{$1^x}');
                formats.push('g(x) = ' + fractionFormat);
                formats.push(fractionFormat);
            }
            
            return [...new Set(formats)]; // Remove duplicates
        }

        function generateCorrectFeedbackY(formats) {
            let html = '<div class="bg-green-100 text-green-800 p-4 rounded-lg">';
            html += '<h6 class="font-semibold mb-2">✅ Benar!</h6>';
            html += '<div class="space-y-2">';
            
            formats.slice(0, 4).forEach((format, index) => {
                const labels = ['Format Standar:', 'Format Sederhana:', 'Format Superscript:', 'Format Alternatif:'];
                html += `<div class="answer-format">`;
                html += `<div class="answer-format-label">${labels[index] || 'Format Lain:'}</div>`;
                html += `<div>$${format}$</div>`;
                html += `</div>`;
            });
            
            html += '</div></div>';
            return html;
        }

        function generateIncorrectFeedbackY(formats) {
            let html = '<div class="bg-red-100 text-red-800 p-4 rounded-lg">';
            html += '<h6 class="font-semibold mb-2">❌ Belum tepat</h6>';
            html += '<p class="mb-3">Jawaban yang benar adalah:</p>';
            html += '<div class="space-y-2">';
            
            formats.slice(0, 3).forEach((format, index) => {
                const labels = ['Format Standar:', 'Format Sederhana:', 'Menggunakan Sifat Eksponen:'];
                html += `<div class="answer-format">`;
                html += `<div class="answer-format-label">${labels[index]}</div>`;
                html += `<div>$${format}$</div>`;
                html += `</div>`;
            });
            
            html += '</div></div>';
            return html;
        }

        function nextQuestionX() {
            if (currentQuestionX < 10) {
                currentQuestionX++;
                document.getElementById('current-question-x').textContent = currentQuestionX;
                document.getElementById('answer-x').value = '';
                document.getElementById('feedback-x').innerHTML = '';
                displayQuestionX();
            } else {
                document.getElementById('feedback-x').innerHTML = `<div class="bg-blue-100 text-blue-800 p-3 rounded-lg">🎉 Selamat! Anda telah menyelesaikan semua soal. Skor akhir: ${scoreX}/10</div>`;
            }
        }

        function nextQuestionY() {
            if (currentQuestionY < 10) {
                currentQuestionY++;
                document.getElementById('current-question-y').textContent = currentQuestionY;
                document.getElementById('answer-y').value = '';
                document.getElementById('feedback-y').innerHTML = '';
                displayQuestionY();
            } else {
                document.getElementById('feedback-y').innerHTML = `<div class="bg-blue-100 text-blue-800 p-3 rounded-lg">🎉 Selamat! Anda telah menyelesaikan semua soal. Skor akhir: ${scoreY}/10</div>`;
            }
        }

        function generateNewQuestionX() {
            generateQuestionsX();
            currentQuestionX = 1;
            scoreX = 0;
            document.getElementById('current-question-x').textContent = currentQuestionX;
            document.getElementById('score-x').textContent = scoreX;
            document.getElementById('answer-x').value = '';
            document.getElementById('feedback-x').innerHTML = '';
            displayQuestionX();
        }

        function generateNewQuestionY() {
            generateQuestionsY();
            currentQuestionY = 1;
            scoreY = 0;
            document.getElementById('current-question-y').textContent = currentQuestionY;
            document.getElementById('score-y').textContent = scoreY;
            document.getElementById('answer-y').value = '';
            document.getElementById('feedback-y').innerHTML = '';
            displayQuestionY();
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Generate initial questions
            generateQuestionsX();
            generateQuestionsY();
            displayQuestionX();
            displayQuestionY();
            
            // Initialize all math inputs
            document.querySelectorAll('.math-input').forEach(input => {
                setupMathInput(input);
            });
            
            // Initialize MathJax rendering
            if (window.MathJax) {
                MathJax.typesetPromise();
            }
            
            // Hide keyboard when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.keyboard-container') && !e.target.matches('input[type="text"], textarea, button')) {
                    hideCurrentKeyboard();
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a3b8b0351c2f6c',t:'MTc1NDM2OTkyOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
